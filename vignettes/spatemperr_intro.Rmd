---
title: "An Introduction to spatemperr"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Intro to spatemperr}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.height = 5, fig.width = 8, message = TRUE, warning = FALSE)
```

`spatemperr` is an `R` package that fits spatio-temporal regression model based on Chi & Zhu *Spatial Regression Models for the Social Sciences* (2019). Based on Elhorst 2001, 2003, and 2010a, the approach here fits a spatial error model while incorporating a temporally lagged response variable, temporally lagged explanatory variables, and spatially lagged explanatory variables.

This package builds on the `lagsarlm()` function from the `spatialreg` package.

This package is still under development. Please report bugs or constructive tips to issues [here](https://github.com/mkamenet3/spatemperr/issues).


#Introduction


Fit a spatial error model but include a temporally lagged response variable, temporally lagged explanatory variable, and temporally and spatially lagged explanatory variables.

Spatial error model at time $t$:

$$Y_t = X_t \beta + u_t, u_t=\rho Wu_t + \varepsilon$$

Adding in a temporally lagged response variable and temporally lagged explanatory variable:

$$Y_t = X_t\beta_t + \beta_2Y_{t-1} + X_{t-1}\beta_3 + u_t, u_t=\rho Wu_t + \varepsilon$$


This becomes:

$$Y_t = Y_{t-1} \beta_2 + \rho W Y_t - \rho\beta_2 WY_{t-1} + X_t \beta_1 + X_{t-1}\beta_3 - W X_t \rho \beta_1 -WX_{t-1} \rho \beta_3 + \varepsilon$$


##Example 1: Produce in the United States


**TODO: Introduce example**


```{r}
#load data example
data("Produc", package = "Ecdat")
data("usaww")

#explore the data structures
str(Produc)
str(usaww)

#create list of spatial weights
usalw <- mat2listw(usaww)
str(usalw)

formula <- as.formula( gsp_log  ~ pcap_log + pc_log + emp_log + unemp)
out <- spatemperr(formula, id="state", data=Produc, listw= usalw, time=2,trans="log",year==1970 | year==1971)
summary(out)
```








